# TextBricks v0.3.0 架構規劃

## 📋 版本概述

TextBricks v0.3.0 將引入革命性的階層式主題系統，取代現有的語言導向分類，提供更靈活和直觀的程式碼模板組織方式。

### 🎯 核心目標
- 實現階層式主題導航系統
- 建立平台無關的儲存架構
- 統一導航項目介面（資料夾/模板/連結）
- 重新設計 TextBricks Manager
- 支援 ZIP + JSON 雙格式匯入匯出

## 🏗️ 架構變更

### 1. 導航系統重構

#### NavigationItem 統一介面
```typescript
interface NavigationItem {
  id: string;              // 唯一識別碼
  title: string;           // 顯示名稱
  type: 'folder' | 'template' | 'link';  // 項目類型
  targetId: string;        // 目標識別碼
  linkType?: 'folder' | 'template';      // 連結類型（僅限 link）
  icon?: string;           // 自訂圖示
  badge?: string;          // 徽章文字
  documentation?: Documentation;  // 說明文檔
}
```

#### 主題配置結構
```typescript
interface TopicConfig {
  id: string;
  title: string;
  navigation: NavigationItem[];
  metadata: {
    version: string;
    created: Date;
    modified: Date;
    author?: string;
    scope: string;
  };
  documentation?: Documentation;
}
```

### 2. 儲存架構重構

#### 系統標準目錄
- **macOS**: `~/Library/Application Support/TextBricks/`
- **Windows**: `%APPDATA%/TextBricks/`
- **Linux**: `~/.local/share/TextBricks/`

#### 範圍管理結構
```
TextBricks/
├── local/                    # 本機範圍
│   ├── topic.json
│   ├── templates/
│   ├── links/
│   └── subtopics/
├── user1/                    # 用戶範圍
│   ├── topic.json
│   └── ...
└── MyProject/               # 專案範圍
    ├── topic.json
    └── ...
```

### 3. 文檔系統增強

#### Documentation 類型
```typescript
interface Documentation {
  type: 'inline' | 'file' | 'url';
  content: string;    // inline: 直接內容, file: 檔案路徑, url: 網址
  title?: string;     // 文檔標題
  language?: string;  // 語法高亮語言
}
```

## 🚀 開發階段

### Phase 1: 核心資料結構 (2-3 週)
- [ ] 實現 NavigationItem 介面
- [ ] 建立階層式主題資料模型
- [ ] 建立新的儲存架構
- [ ] 實現範圍管理系統

### Phase 2: 儲存與載入 (2-3 週)
- [ ] 實現新的資料載入邏輯
- [ ] 建立資料遷移機制
- [ ] 實現 topic.json 處理
- [ ] 測試儲存架構穩定性

### Phase 3: UI 重新設計 (3-4 週)
- [ ] 重新設計主面板導航
- [ ] 實現階層式瀏覽
- [ ] 新增連結支援
- [ ] 優化使用者體驗

### Phase 4: TextBricks Manager v3 (2-3 週)
- [ ] 重新設計管理介面
- [ ] 實現樹狀導航
- [ ] 新增拖放功能
- [ ] 整合文檔編輯器

### Phase 5: 匯入匯出系統 (2 週)
- [ ] 實現 ZIP 格式支援
- [ ] 建立 JSON 相容性
- [ ] 批次操作功能
- [ ] 資料驗證機制

### Phase 6: 測試與優化 (2 週)
- [ ] 完整功能測試
- [ ] 效能優化
- [ ] 文檔完善
- [ ] 使用者回饋整合

## 🔄 資料遷移策略

### 從 v0.2.5 到 v0.3.0
1. **自動偵測舊格式**：檢查 `packages/vscode/src/data/templates.json`
2. **建立新結構**：在系統目錄建立 `local/` 範圍
3. **轉換資料**：將語言分類轉換為主題結構
4. **保留原檔**：備份舊格式檔案
5. **驗證完整性**：確保所有模板成功遷移

### 遷移對應關係
- `templates.json` → 分散到各主題資料夾
- 語言分類 → 成為頂層主題
- 主題層級 → 轉換為階層式結構
- 模板內容 → 保持不變，重新組織

## 🛠️ 技術實現細節

### 核心套件更新
- **@textbricks/core**: 新增階層式資料模型
- **@textbricks/shared**: 擴展共用介面
- **@textbricks/vscode**: 更新 UI 和命令

### 新增功能模組
- **HierarchyManager**: 階層式導航管理
- **ScopeManager**: 範圍管理系統
- **LinkResolver**: 連結解析器
- **MigrationEngine**: 資料遷移引擎

### API 變更
- 新增階層式導航 API
- 擴展模板載入邏輯
- 更新搜尋和篩選功能
- 增強文檔處理能力

## 📊 預期效益

### 使用者體驗
- 更直觀的主題組織
- 靈活的客製化能力
- 改善的導航體驗
- 強化的文檔整合

### 開發效率
- 平台無關的架構
- 可擴展的系統設計
- 簡化的資料管理
- 增強的測試覆蓋

### 維護性
- 模組化的程式碼結構
- 清晰的職責分離
- 完善的文檔系統
- 標準化的資料格式

## 🎯 成功指標

- [ ] 完整的階層式導航實現
- [ ] 100% 的資料遷移成功率
- [ ] 新 UI 使用者接受度 > 85%
- [ ] 系統效能維持或改善
- [ ] 零重大問題的穩定發布

---

**版本**: v0.3.0
**更新**: 2025-09-24
**狀態**: 規劃階段