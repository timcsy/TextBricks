# TextBricks - VSCode Extension PRD

## 產品概述

TextBricks 是一個專為程式設計初學者設計的多語言 VSCode 擴展外掛，提供結構化的程式碼模板集合，支持 C、Python、JavaScript 三種程式語言，幫助學生從零開始學習程式設計。

## 產品目標

- 降低初學者學習程式設計的門檻，支持多種程式語言
- 提供結構化的學習路徑和豐富的程式碼模板
- 簡化程式碼輸入流程，讓學生專注於邏輯學習
- 提升程式設計教學效率和學習體驗

## 目標用戶

**主要用戶**：程式設計初學者（大學生、高中生、自學者）
**次要用戶**：程式設計教師、培訓機構
**涵蓋語言**：C、Python、JavaScript 學習者

## 核心功能

### 1. 側邊欄面板
- 在 VSCode 側邊欄顯示 TextBricks 面板
- 提供清晰的圖形化界面

### 2. 多語言支持系統
- **C 語言**：傳統系統程式語言，完整的基礎到進階概念
- **Python**：現代易學語言，重視語法簡潔和可讀性
- **JavaScript**：網頁開發和腳本語言，包含現代 ES6+ 特性
- **動態語言切換**：頭部語言選擇器，即時切換語言模板

### 3. 分層級模板系統
**基礎層級結構**（適用所有語言）：
- **基礎語法**: Hello World、變數宣告、基本輸入輸出
- **控制結構**: if-else 條件判斷、for 迴圈、while 迴圈
- **函數與資料**: 函數定義、陣列/列表操作、參數傳遞  
- **進階應用**: 物件導向程式設計、資料結構、檔案操作、非同步程式設計

### 4. 卡片式模板展示
- 每個層級包含多張模板卡片
- 卡片顯示程式碼片段標題和簡短說明
- 簡潔清晰的視覺設計

### 5. 模板使用功能
- **點擊插入**：點擊卡片直接插入程式碼到編輯器當前游標位置 ⭐ v0.1.6 更新
- **拖曳插入**：可直接拖曳卡片到編輯器中插入程式碼
- **互動式預覽**：懸停眼睛按鈕顯示程式碼詳細內容
- **工具提示功能**：預覽 tooltip 同時提供複製和插入按鈕 ⭐ v0.1.6 更新
- **智慧文字選擇**：當有文字被選取時，僅插入或複製選取的部分 ⭐ v0.1.6 新功能
- **自動後備機制**：沒有活動編輯器時自動複製到剪貼簿，並提供新檔案選項 ⭐ v0.1.6 新功能

### 6. 進階模板管理系統
- **Template Manager**：完整的模板 CRUD 操作介面
- **JSON 批次匯入**：快速新增大量模板
- **匯入匯出功能**：備份和分享模板集合
- **資料驗證**：確保模板資料完整性
- **分類管理**：自訂模板分類和難度等級

### 7. 智能推薦系統
- **常用模板推薦**：基於使用頻率自動推薦熱門模板
- **個人化推薦**：根據最近使用記錄智能推薦相關模板
- **上下文感知推薦**：分析當前編程環境動態調整模板順序
- **使用統計追蹤**：自動記錄模板使用次數和時間
- **視覺化標識**：推薦模板採用特殊徽章和動態效果標識

### 8. 智慧縮排系統 ⭐ v0.1.5 新功能
- **智慧複製貼上**：自動調整模板縮排至游標位置
- **上下文感知格式化**：保持相對縮排關係，智能處理基準層級
- **多行模板支持**：正確處理複雜嵌套縮排，支持一致性檢測
- **工具提示文字選擇**：選取文字複製時智慧縮排，自動恢復丟失的縮排
- **模板感知格式化**：結合模板上下文進行精確的縮排計算
- **無縫整合**：所有複製操作自動生效，支持GitHub Codespaces等環境

### 9. 說明文檔系統 ⭐ v0.1.4 功能
- **內嵌 Markdown 文檔**：直接在模板數據中包含完整的說明文檔
- **外部文件支持**：支持本地 .md 文件和外部 URL 鏈接
- **智能類型判斷**：自動識別 URL、文件路徑或內嵌內容，修復多行 Markdown 內容誤判問題
- **標準文檔格式**：統一的文檔結構包含功能簡介、模板內容、範例輸入輸出、重點說明
- **Template Manager 編輯**：在模板管理界面中編輯和預覽說明文檔
  - **模態預覽功能**：內置模態視窗預覽 Markdown 渲染效果，適配 VS Code webview 環境
  - **三種文檔類型支持**：Markdown 內容、本地文件路徑、外部 URL 的完整預覽
  - **實時渲染**：支持標題、程式碼區塊、列表、連結等完整 Markdown 語法
- **側邊展示面板**：在編輯器旁邊開啟說明文檔，支持 Markdown 渲染和語法高亮
- **UI 優化整合**：說明按鈕從模板卡片移至 hover tooltip，保持界面簡潔
  - **Tooltip 集成**：在模板預覽 tooltip 中提供說明文檔快速入口
  - **一鍵開啟**：點擊 📖 說明按鈕直接在側邊面板開啟完整文檔
- **互動式程式碼區塊 ⭐ v0.1.6 新功能**：說明文檔中的程式碼區塊提供插入和複製按鈕
  - **智慧選擇支持**：支援在說明文檔程式碼區塊中選取特定部分進行插入或複製
  - **統一操作體驗**：說明文檔程式碼區塊操作與主面板模板操作保持一致性
  - **視覺優化設計**：清潔的程式碼區塊標題列，包含語言標籤和操作按鈕

## 技術規格

### 開發環境
- **框架**：VSCode Extension API
- **語言**：TypeScript
- **UI 框架**：Webview API + HTML/CSS/JavaScript
- **目標平台**：VSCode (Windows, macOS, Linux)
- **測試框架**：Jest 單元測試
- **打包工具**：vsce (Visual Studio Code Extension CLI)

### 核心架構
- **Extension 主程式**：extension.ts（TypeScript）
- **雙 Webview 面板系統**：
  - 主要模板顯示面板（WebviewProvider.ts）
  - 模板管理介面（TemplateManagerProvider.ts）
- **服務層**：
  - TemplateManager.ts：核心模板載入和組織
  - TemplateManagementService.ts：進階 CRUD 和推薦算法
  - ContextAnalysisService.ts：上下文分析和機器學習
- **資料模型**：Template.ts 定義資料結構和上下文模型
- **JSON 資料庫**：templates.json 儲存所有模板資料和使用統計
- **前端資源**：分離的 CSS/JS 檔案支持兩個面板
- **智能推薦系統**：基於上下文分析的動態模板排序

## 用戶故事

### 多語言學習流程
1. 安裝 TextBricks 擴展
2. 開啟程式碼檔案（.c、.py、.js 等）
3. 在活動列找到 TextBricks 面板
4. 使用語言選擇器切換到目標語言
5. 從基礎語法開始瀏覽模板
6. 點擊或拖曳需要的程式碼模板
7. 在編輯器中學習和修改程式碼

### 典型使用場景
**場景1**: Python 新手寫第一個程式
- 開啟 TextBricks 面板
- 切換語言選擇器到 Python
- 選擇 "Hello World" 模板
- 點擊複製並貼到 .py 檔案
- 執行程式看到結果

**場景2**: 學習 JavaScript 陣列操作
- 切換到 JavaScript 語言
- 瀏覽函數與資料操作相關模板
- 比較陣列操作和高階函數模板
- 拖曳合適的模板到程式中
- 修改參數完成練習

**場景3**: 教師管理自訂模板
- 開啟 Template Manager
- 使用 JSON 批次匯入功能
- 新增課程專用模板
- 匯出模板集合分享給學生

**場景4**: 智能推薦提升學習效率
- 開始 Python 數據處理項目
- TextBricks 自動分析項目環境
- 推薦區域顯示「⭐ 推薦模板」和「🔥 常用模板」
- 在 for 迴圈附近時智能推薦列表操作模板
- 根據技能等級動態調整模板複雜度

## MVP 功能範圍

### 已實現功能
- ✅ 側邊欄面板顯示
- ✅ 4個學習層級分類
- ✅ C、Python、JavaScript 三語言支持
- ✅ 每語言每層級多個核心模板
- ✅ 點擊複製功能
- ✅ 拖曳插入功能
- ✅ 互動式預覽功能
- ✅ 語言切換選擇器
- ✅ Template Manager 完整模板管理系統
- ✅ JSON 批次匯入匯出功能
- ✅ 模板 CRUD 操作
- ✅ 資料驗證機制
- ✅ 響應式 UI 設計
- ✅ 智能推薦系統（個人化推薦、使用頻率分析）
- ✅ 使用統計追蹤和視覺化標識（⭐星號標記）
- ✅ 上下文感知推薦架構（預留擴展）
- ✅ 階層動態展開收合效果（cubic-bezier動畫）
- ✅ 推薦區統一黃金色主題設計
- ✅ 模板卡片動態視覺反饋
- ✅ **智慧縮排系統** (v0.1.5)：智慧複製貼上，自動調整縮排到游標位置，支持多行模板和工具提示選擇
- ✅ **說明文檔系統** (v0.1.4)：
  - ✅ 模板內嵌說明文檔支持（智能類型判斷修復）
  - ✅ 外部 Markdown 文件和 URL 鏈接支持
  - ✅ 標準文檔格式（功能簡介、模板內容、範例輸入輸出、重點說明）
  - ✅ Template Manager 中的文檔編輯和模態預覽功能
  - ✅ Tooltip 中的說明按鈕（📖 圖標）整合
  - ✅ 編輯器旁邊開啟說明頁面的側邊面板
  - ✅ 完整 Markdown 渲染和語法高亮支持

### v0.1.6 版本更新 ⭐ 最新版本
- 🚀 **主要功能改進**：將主要操作從複製改為插入，提升開發工作流程效率
- ✨ **智慧文字選擇**：支援在模板預覽和說明文檔中選取特定文字範圍進行操作
- 🔧 **智慧編輯器偵測**：沒有活動編輯器時提供後備機制和新檔案創建選項
- 📖 **說明文檔互動增強**：說明文檔程式碼區塊加入插入和複製按鈕
- 🎨 **視覺設計優化**：改進所有操作按鈕的樣式設計，提升使用者體驗

### v0.1.5 版本功能
- ✅ 智慧縮排系統完整實現
- ✅ 上下文感知格式化
- ✅ GitHub Codespaces 支持優化

### v0.1.4 版本重要修復
- 🔧 修復 DocumentationService 類型判斷邏輯，正確處理多行 Markdown 內容
- 🔧 修復 Template Manager 載入問題（JavaScript 語法錯誤）
- 🔧 修復預覽模態視窗關閉問題（事件處理優化）
- 🔧 改進錯誤處理和調試支援

### 未來版本規劃
- ❌ 模板搜尋功能
- ❌ 學習進度追蹤
- ❌ 更多程式語言支持（Java、Go、Rust）
- ❌ 協作和分享功能
- ❌ VS Code 主題整合
- 🚧 **上下文感知推薦完整實現**：
  - 項目類型自動檢測（React、Vue、Express等）
  - 游標位置智能推薦（函數內推薦相關結構）
  - 框架相關模板推薦
  - 技能等級自動評估和適配
  - 機器學習驅動的個人化推薦
  - 代碼模式識別和預測推薦

## 成功指標

- 擴展安裝數量
- 用戶使用頻率
- 模板複製/使用次數
- 用戶評價和反饋

## 時程規劃

**已完成階段**：
- ✅ **Phase 1**：核心架構和基礎UI（2週）
- ✅ **Phase 2**：C語言模板系統（2週）
- ✅ **Phase 3**：複製拖曳功能（1週）
- ✅ **Phase 4**：基礎版本測試（1週）
- ✅ **Phase 5**：多語言支持（3週）
- ✅ **Phase 6**：Template Manager 開發（2週）
- ✅ **Phase 7**：匯入匯出功能（1週）
- ✅ **Phase 7.5**：智能推薦系統和UI動效優化（1週）

**當前狀態**：v0.1.5 開發完成，智慧縮排系統全面優化，包含模板感知格式化、一致性檢測、自動縮排恢復等高級功能

**當前開發階段**：
- **Phase 8 (1週)**：說明文檔系統開發
  - 擴展 Template 數據模型支持 documentation 字段
  - 實現智能類型判斷（URL、文件路徑、內嵌 Markdown）
  - 創建 DocumentationProvider 和 DocumentationService
  - 在 Template Manager 中添加文檔編輯功能
  - UI 更新：模板卡片添加說明按鈕
  - 實現側邊文檔展示面板

**未來階段規劃**：
- **Phase 9 (2週)**：搜尋和篩選功能
- **Phase 10 (4週)**：上下文感知推薦完整實現
  - 項目環境檢測和框架識別
  - 游標位置感知和代碼模式分析
  - 機器學習推薦算法優化
- **Phase 10 (3週)**：學習進度追蹤系統
- **Phase 11 (2週)**：更多語言支持

## 風險評估

- **技術風險**：✅ 已解決 - VSCode拖曳API實現完成
- **用戶風險**：多語言支持提升工具接受度
- **競品風險**：差異化功能（多語言、結構化學習、模板管理）
- **擴展性風險**：JSON檔案儲存可能需要遷移到資料庫
- **維護風險**：多語言模板內容需要持續更新

## 未來規劃

- **v0.2.0**: 新增搜尋和篩選功能
- **v0.3.0**: 上下文感知推薦完整實現
  - 智能項目檢測和框架識別
  - 游標位置感知推薦
  - 機器學習個人化推薦算法
  - 技能等級自動評估系統
- **v0.4.0**: 學習進度追蹤和統計分析
- **v0.5.0**: 更多程式語言支持（Java、Go、Rust）
- **v0.6.0**: 社群分享和協作功能
- **v1.0.0**: 與線上教學平台整合
- **長期規劃**: AI 輔助程式碼生成和智能學習建議